<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics - Atomic Design</title>
  <link rel="stylesheet" href="/css/atomic.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="dashboard-layout">
    <%- include('components/organisms/sidebar', { path: '/analytics' }) %>

    <main class="main-content">
      <header class="flex-between mb-4">
        <div>
          <h2 style="margin:0">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• üìà</h2>
          <p style="color:var(--text-muted); margin-top:0.5rem">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</p>
        </div>
        <div style="font-size:0.9rem; color:var(--text-muted); background:white; padding:0.5rem 1rem; border-radius:8px; border:1px solid var(--gray-300)">
          üìÖ <%= new Date().toLocaleDateString('th-TH', { month: 'long', year: 'numeric' }) %>
        </div>
      </header>

      <!-- Stats Row -->
      <div class="o-stats-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 2rem;">
        <%- include('components/molecules/stat-card', {
             title: '‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô',
             value: formatCurrency(dailyAvg),
             subtext: 'üóìÔ∏è ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å ' + daysCount + ' ‡∏ß‡∏±‡∏ô',
             color: '#4361ee'
           }) %>
        
        <%- include('components/molecules/stat-card', {
             title: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î',
             value: formatCurrency(maxExpenseDay.amount),
             subtext: 'üìÖ ' + formatDate(maxExpenseDay.date),
             color: '#f72585'
           }) %>

        <%- include('components/molecules/stat-card', {
             title: '‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î',
             value: topCategory.name,
             subtext: 'üí∏ ' + formatCurrency(topCategory.amount),
             color: '#f8961e'
           }) %>
      </div>

      <!-- Charts Grid -->
      <div class="o-content-grid">
        <!-- Main Bar Chart -->
        <div style="grid-column: span 2;">
          <%- include('components/organisms/charts/bar-chart', {
               id: 'dailyTrendChart',
               title: '‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô',
               label: '‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)',
               labels: dailyLabels,
               data: dailyData,
               color: '#4cc9f0'
             }) %>
        </div>

        <!-- Secondary Charts Column -->
        <div style="display:flex; flex-direction:column; gap:1.5rem">
          <%- include('components/organisms/charts/doughnut-chart', {
               id: 'categoryPieChart',
               title: '‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà',
               labels: catLabels,
               data: catData,
               colors: catColors
             }) %>
        </div>
      </div>
    </main>
  </div>
</body>
</html>
