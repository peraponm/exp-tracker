<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ - Expense Tracker</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <nav class="navbar">
    <div class="container">
      <div class="nav-brand">
        <h1>üí∞ Expense Tracker</h1>
      </div>
      <ul class="nav-menu">
        <li><a href="/" class="nav-link">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</a></li>
        <li><a href="/dashboard" class="nav-link">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (‡πÉ‡∏´‡∏°‡πà)</a></li>
        <li><a href="/analytics" class="nav-link">‡∏Å‡∏£‡∏≤‡∏ü (‡πÉ‡∏´‡∏°‡πà)</a></li>
        <li><a href="/expenses/summary" class="nav-link">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</a></li>
        <li><a href="/expenses/add" class="btn btn-primary">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</a></li>
      </ul>
    </div>
  </nav>

  <main class="container">
    <div class="page-header">
      <h2>üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h2>
      <a href="/" class="btn btn-outline">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</a>
    </div>

    <div class="card">
      <div class="card-header">
        <h3>üîç ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</h3>
      </div>
      <div class="card-body">
        <form method="GET" action="/expenses/summary" class="filter-form">
          <div class="form-row">
            <div class="form-group">
              <label for="start_date">‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
              <input type="date" name="start_date" id="start_date" class="form-control" 
                     value="<%= filters.start_date %>" required>
            </div>
            
            <div class="form-group">
              <label for="end_date">‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
              <input type="date" name="end_date" id="end_date" class="form-control" 
                     value="<%= filters.end_date %>" required>
            </div>
            
            <div class="form-group">
              <label>&nbsp;</label>
              <button type="submit" class="btn btn-primary">‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ</button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <div class="summary-cards">
      <div class="summary-card">
        <div class="summary-icon">üí∞</div>
        <div class="summary-content">
          <div class="summary-label">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
          <div class="summary-value"><%= formatCurrency(total) %></div>
        </div>
      </div>

      <div class="summary-card">
        <div class="summary-icon">üìù</div>
        <div class="summary-content">
          <div class="summary-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
          <div class="summary-value"><%= expenses.length %> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
        </div>
      </div>

      <div class="summary-card">
        <div class="summary-icon">üìä</div>
        <div class="summary-content">
          <div class="summary-label">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô</div>
          <div class="summary-value">
            <% 
              const startDate = new Date(filters.start_date);
              const endDate = new Date(filters.end_date);
              const daysDiff = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
              const avgPerDay = daysDiff > 0 ? (total / daysDiff) : 0;
            %>
            <%= formatCurrency(avgPerDay) %>
          </div>
        </div>
      </div>

      <div class="summary-card">
        <div class="summary-icon">üìÇ</div>
        <div class="summary-content">
          <div class="summary-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</div>
          <div class="summary-value"><%= Object.keys(breakdown).length %> ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h3>üìÇ ‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</h3>
      </div>
      <div class="card-body">
        <% if (Object.keys(breakdown).length === 0) { %>
          <div class="empty-state">
            <p>üòä ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ</p>
          </div>
        <% } else { %>
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                  <th class="text-center">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                  <th class="text-right">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                  <th class="text-right">‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå</th>
                  <th>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô</th>
                </tr>
              </thead>
              <tbody>
                <% Object.entries(breakdown).forEach(([categoryName, data]) => { %>
                  <tr>
                    <td>
                      <span class="category-badge" style="background-color: <%= data.color %>20; color: <%= data.color %>;">
                        <%= data.icon %> <%= categoryName %>
                      </span>
                    </td>
                    <td class="text-center"><%= data.count %></td>
                    <td class="text-right"><strong><%= formatCurrency(data.amount) %></strong></td>
                    <td class="text-right"><%= data.percentage %>%</td>
                    <td>
                      <div class="progress-bar">
                        <div class="progress-fill" style="width: <%= data.percentage %>%; background-color: <%= data.color %>;"></div>
                      </div>
                    </td>
                  </tr>
                <% }); %>
              </tbody>
              <tfoot>
                <tr class="total-row">
                  <td><strong>‡∏£‡∏ß‡∏°</strong></td>
                  <td class="text-center"><strong><%= expenses.length %></strong></td>
                  <td class="text-right"><strong><%= formatCurrency(total) %></strong></td>
                  <td class="text-right"><strong>100%</strong></td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
          </div>
        <% } %>
      </div>
    </div>

    <% if (expenses.length > 0) { %>
      <div class="card">
        <div class="card-header">
          <h3>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ</h3>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                  <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                  <th>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</th>
                  <th class="text-right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                </tr>
              </thead>
              <tbody>
                <% expenses.forEach(expense => { %>
                  <tr>
                    <td><%= formatDate(expense.expense_date) %></td>
                    <td>
                      <span class="category-badge" style="background-color: <%= expense.color %>20; color: <%= expense.color %>;">
                        <%= expense.icon %> <%= expense.category_name %>
                      </span>
                    </td>
                    <td><%= expense.description || '-' %></td>
                    <td class="text-right"><%= formatCurrency(expense.amount) %></td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    <% } %>
  </main>

  <footer class="footer">
    <div class="container">
      <p>&copy; 2026 Expense Tracker - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô</p>
    </div>
  </footer>

  <script src="/js/main.js"></script>
</body>
</html>
